asyncapi: 2.6.0
id: com.example.myservice
defaultContentType: application/json
info:
  title: My FastStream RabbitMQ Service
  version: 1.0.0
  description: "\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043C\u043E\u0435\
    \u0433\u043E \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u043D\u0430 FastStream\
    \ \u0438 RabbitMQ"
servers:
  development:
    url: amqp://guest:guest@localhost:5672/
    protocol: amqp
    protocolVersion: 0.9.1
channels:
  chuck_video:video_processor:HandleChuckVideo:
    servers:
    - development
    bindings:
      amqp:
        is: routingKey
        bindingVersion: 0.2.0
        queue:
          name: chuck_video
          durable: false
          exclusive: false
          autoDelete: false
          vhost: /
        exchange:
          type: topic
          name: video_processor
          durable: false
          autoDelete: false
          vhost: /
    subscribe:
      bindings:
        amqp:
          cc: chuck_video.request.*
          ack: true
          bindingVersion: 0.2.0
      message:
        $ref: '#/components/messages/chuck_video:video_processor:HandleChuckVideo:Message'
  chuck_video:trigger:HandleChuckVideo:
    servers:
    - development
    bindings:
      amqp:
        is: routingKey
        bindingVersion: 0.2.0
        queue:
          name: chuck_video
          durable: false
          exclusive: false
          autoDelete: false
          vhost: /
        exchange:
          type: topic
          name: trigger
          durable: false
          autoDelete: false
          vhost: /
    subscribe:
      bindings:
        amqp:
          cc: trigger_api.response.*
          ack: true
          bindingVersion: 0.2.0
      message:
        $ref: '#/components/messages/chuck_video:trigger:HandleChuckVideo:Message'
  chuck_video.response.*:video_processor:Publisher:
    servers:
    - development
    bindings:
      amqp:
        is: routingKey
        bindingVersion: 0.2.0
        exchange:
          type: topic
          name: video_processor
          durable: false
          autoDelete: false
          vhost: /
    publish:
      bindings:
        amqp:
          cc: chuck_video.response.*
          ack: true
          deliveryMode: 1
          mandatory: true
          bindingVersion: 0.2.0
      message:
        $ref: '#/components/messages/chuck_video.response.*:video_processor:Publisher:Message'
components:
  messages:
    chuck_video:video_processor:HandleChuckVideo:Message:
      title: chuck_video:video_processor:HandleChuckVideo:Message
      correlationId:
        location: $message.header#/correlation_id
      payload:
        $ref: '#/components/schemas/ChunkVideoRequest'
    chuck_video:trigger:HandleChuckVideo:Message:
      title: chuck_video:trigger:HandleChuckVideo:Message
      correlationId:
        location: $message.header#/correlation_id
      payload:
        $ref: '#/components/schemas/ChunkVideoRequest'
    chuck_video.response.*:video_processor:Publisher:Message:
      title: chuck_video.response.*:video_processor:Publisher:Message
      correlationId:
        location: $message.header#/correlation_id
      payload:
        $ref: '#/components/schemas/ChunkVideoRequest'
  schemas:
    ChunkVideoRequest:
      properties:
        request_id:
          title: Request Id
          type: string
        videoUrl:
          title: Videourl
          type: string
        chuck_amount:
          title: Chuck Amount
          type: integer
      required:
      - videoUrl
      - chuck_amount
      title: ChunkVideoRequest
      type: object
